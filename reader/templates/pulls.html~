<html>
<head>

<script type="text/javascript" src="/js/jquery.js"></script>  
<script type="text/javascript" src="/js/jquery-ui.js"></script>  

<script>
function findFeed(){
q=$("#id_feed_url").attr('value');
$("#id_feed_url").attr("value","please wait...");
$.ajax({
      url: "/find_feed/",
      global: false,
      type: "POST",
      data: ({url : q}),
      success: function(msg){
	if (msg!="None"){
	 $("#id_feed_url").css("color","black");
         $("#id_feed_url").attr("value",msg);
	 $("#id_feed_cheked").attr("value","True");
	}
	else{
	 $("#id_feed_url").css("color","red");
         $("#id_feed_url").attr("value","No feeds found!");
	 $("#id_feed_cheked").attr("value","False");
	}
      }
   }
)
}

function suggest_feed(){
/*q=$("#id_feed_url").attr('value');
$.post("/suggest_feed/",
    {control_id : "id_feed_url",div_id:"suggest_feed_div",first_chars:q},
    function(data){
	$("#suggest_feed_div").html(data);
	$("#suggest_feed_div").show("fast");
    }
);*/
}

function togglepull(a){
$('#pullbody'+a).toggle();
if ($('#togglepull'+a).text()=='show')
$('#togglepull'+a).text('hide');
else
$('#togglepull'+a).text('show');
}

function cleanpull(a){
if (confirm("Are you SURE?\nThere will be no undo and all data will be lost!")){
$.ajax({
      url: "/clean_pull/",
      global: false,
      type: "POST",
      data: ({id : a}),
      success: function(msg){
	if (msg!="Ok"){
	 alert("Something gone wrong");
	}
	else{
	 $("#pullbody"+a).text("");
	}
      }
   }
)
}
}

function purgepull(a){
if (confirm("Are you SURE?\nThere will be no undo and all data will be lost!")){
$.ajax({
      url: "/purge_pull/",
      global: false,
      type: "POST",
      data: ({id : a}),
      success: function(msg){
	if (msg!="Ok"){
	 alert("Something gone wrong");
	}
	else{
	 $("#pullbody"+a).text("");
	}
      }
   }
)
}
}

</script>

<link type="text/css" href="/css/main.css" rel="stylesheet" />
</head>
<body>
<div id="container">
<div id="header">
Seetho. News filtering, systematization and group aggregation.
</div>

<div class="mainmenu">
<div class="button" onclick="javascript:document.location='/'">News</div>
<div class="button_disabled">Pulls</div>
<div class="button" onclick="javascript:document.location='/groups'">Groups</div>
<div class="button" onclick="javascript:document.location='/search'">Search</div>
<div class="button" onclick="javascript:document.location='/profile'">Profile</div>
<div class="button" onclick="javascript:document.location='/logout'">Logout</div>
</div>

<div class="submenu">
<div class="subbutton" onclick="javascript:$('#accordion').toggle('normal');">Add new feed</div>
</div>
<div id="main">


<form action="/add_feed/" method="POST">
<div>
{% for field in feedform %}
{{forloop.counter}}. {{field.label}}{{field.errors}}<br/>
{% endfor %}
</div>
<div id="accordion" class="accordion">
<h3><a href="#">Step №1. Select feed</a></h3>
<div style="position: relative;">
Please, enter wanted site's url, and press "Check"-button. Program will automaticaly find rss/atom source.<br />
<input id="id_feed_url" name="feed_url" value="http://" onkeydown='$(this).css("color","black");' onchange='$("#id_feed_cheked").attr("value","False");' onkeyup='javascript:suggest_feed();'/>
<input value="False" name="feed_cheked" id="id_feed_cheked" />
<input type="button" onclick='javascript:findFeed();' value="Check" /><br />
<div id="suggest_feed_div" style="position: absolute; left: 0px; top: 60px;"></div>
<input type="button" onclick="$('#accordion').accordion('activate',1);" value="Next" />
</div>
<h3><a href="#">Step №2. Construct filter</a></h3>
<div>
You can construct filter here. Input words, separated by commas.<br />
News contain <u>all</u> words:<input id="id_filter_must" name="filter_must"/><br />
News contain <u>some</u> words:<input id="id_filter_may" name="filter_may"/><br />
News <u>don't</u> contain <u>any</u> word:<input id="id_filter_not" name="filter_not"/><br />
<input type="button" onclick="$('#accordion').accordion('activate',2);" value="Next" /><input type="button" onclick="$('#accordion').accordion('activate',0);" value="Back" />
</div>
<h3><a href="#">Step №3. Select pull for collected news</a></h3>
<div>
Select or create new pull:<br />
<input id="id_pull_title" name="pull_title" value="Add new pull"/>
<input id="id_pull_id" name="pull_id" value="-1"/>
<br />
<select style="width: 90%" id="pull_exist" onchange="$('#id_pull_title').attr('value',$('#pull_exist :selected').text());$('#id_pull_id').attr('value',$(this).val());">
<option value="-1" selected="true">Add new pull</option>
{% for p in pulls %}
<option value="{{ p.id }}">{{ p.title }}</option>
{% endfor %}
</select><br />
<input type="submit">Done</input><input type="button" onclick="$('#accordion').accordion('activate',1);" value="Back" />
</div>
</div>
</form>

<script type="text/javascript">
  $("#accordion").accordion();
  $("#accordion").hide();
</script>


{% for p,ent in entries %}
<div class="pullheader">
<div class="pullheadertext">{{p.title}}. Last entry: {{ent.0.downloaded}}.</div>
<div class="smallbutton" id="togglepull{{p.id}}" onclick="javascript:togglepull({{p.id}});">hide</div>
<div class="smallbutton">update</div>
<div class="smallbutton" onclick="javascript:cleanpull({{p.id}});">clean</div>
<div class="smallbutton" onclick="javascript:purgepull({{p.id}});">purge</div>
</div>
<div class="pullbody" id="pullbody{{p.id}}">
{% for e in ent %}
<div class="entry">
<div style="display:table-cell;width:100%;"><h3>{{ e.title }}</h3></div>
<div class="timestamp" style="display:table-cell;white-space: nowrap;">{{e.downloaded|date}} {{e.downloaded|time}}</div>
{% autoescape off %}
{{e.summary}}
{% endautoescape %}

</div>
<hr />
{% endfor %}
{% endfor %}
</div>

</div>
<div id="footer">Seetho (c) semenoff.andrew 2009.</div>
</div>
</body>
</html>